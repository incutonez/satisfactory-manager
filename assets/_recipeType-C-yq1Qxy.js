import{n as W,R as K,u as j,b as P,c as x,o as B,p as N,r as c,q as O,j as s,O as $,t as F,v as _,w as q,x as z,y as G,e as H,z as J}from"./index-C79zgZY1.js";import{u as L,e as Q,T as U,d as X,S as Y,g as Z,b as ee}from"./TableData-DBC-qjpO.js";import{u as te,B as g,S as se}from"./BaseDialog-bupQKi7F.js";function oe({show:C}){const{recipeType:o,itemId:f}=W({from:K}),r=j(),i=P(),e=x(B),a=x(N),[I,w]=c.useState(a??[]),[T,R]=c.useState([]),[k,S]=c.useState([]),l=c.useMemo(()=>o==="both",[o]),V=L({data:I,columns:T,getCoreRowModel:ee(),getSortedRowModel:Z(),onSortingChange:S,state:{sorting:k}}),h=c.useCallback(n=>{i({to:O,params:{recipeType:o,itemId:f,recipeId:n}})},[i,o,f]),v=c.useCallback(({id:n})=>{h(n)},[h]);function D(n){n||y()}function y(){i({to:z})}function b(){e&&(r(q(e)),y())}if(c.useEffect(()=>{if(a){const n=e==null?void 0:e.id;w(l?a:a.filter(({items:u})=>u.filter(t=>t.recipeType===o&&t.itemId===n).length))}},[l,a,o,e==null?void 0:e.id]),c.useEffect(()=>{const n=e==null?void 0:e.id,u=[{id:"actions",meta:{cellCls:"flex justify-center space-x-2",columnWidth:"min-w-auto"},cell(t){return s.jsxs(s.Fragment,{children:[s.jsx(g,{icon:X,title:"Delete Recipe",onClick:()=>r(F(t.row.original))}),s.jsx(g,{icon:Y,title:"Edit Recipe",onClick:()=>v(t.row.original)})]})}},{header:"Recipe",accessorKey:"recipeName",cell:t=>t.getValue()},{header:"Overclock",accessorKey:"overclockValue",cell:t=>`${t.getValue()}%`,meta:{cellCls:"text-center",columnWidth:"min-w-auto"}},{header:"Somersloop",accessorKey:"somersloopValue",cell:t=>t.getValue(),meta:{cellCls:"text-center",columnWidth:"min-w-auto"}},{header:"Machine Count",accessorKey:"machineCount",cell:t=>t.getValue(),meta:{cellCls:"text-center",columnWidth:"min-w-auto"}}];(l||o==="produces")&&u.push({header:"Produces",id:"produces_items",accessorKey:"items",meta:{cellCls:"text-center",columnWidth:"min-w-auto"},cell(t){const d=t.getValue().find(p=>p.itemId===n&&p.recipeType==="produces");return d?s.jsx("span",{children:d.amountPerMinuteDisplay}):"-"},footer:()=>(e==null?void 0:e.producingTotal)||"-"}),(l||o==="consumes")&&u.push({header:"Consumes",id:"consumes_items",accessorKey:"items",meta:{cellCls:"text-center",columnWidth:"min-w-auto"},cell(t){const d=t.getValue().find(p=>p.itemId===n&&p.recipeType==="consumes");return d?s.jsx("span",{children:d.amountPerMinuteDisplay}):"-"},footer:()=>(e==null?void 0:e.consumingTotal)||"-"}),l&&u.push({header:"Remaining",meta:{cellCls:"text-center",columnWidth:"min-w-auto",footerCls(){if(!e)return"";const t=e.producingTotal-e.consumingTotal;return t===0?"":t<0?"!bg-red-200":"!bg-green-200"}},footer(){return e?e.producingTotal-e.consumingTotal:"-"}}),R(u),S([{id:"recipeName",desc:!1}])},[v,l,o,R,e,r]),!e)return;let m="Total";o==="produces"?m="Production":o==="consumes"&&(m="Consumption"),m=`${m}: ${e.name}`;const A=s.jsx(g,{text:"Save",icon:se,onClick:b});function E(){h(_)}return s.jsxs(s.Fragment,{children:[s.jsx(te,{title:m,show:C,setShow:D,footerSlot:A,children:s.jsxs("article",{className:"flex flex-col h-full space-y-4",children:[s.jsx("section",{className:"flex space-x-4 items-center",children:s.jsx(g,{title:"Add Recipe",text:"Recipe",icon:Q,onClick:E})}),s.jsx(U,{table:V,showSummary:!0})]})}),s.jsx($,{})]})}const ie=function(){const{itemId:o,recipeType:f}=G.useParams(),[r,i]=c.useState(!1),e=j(),a=x(H);return c.useEffect(()=>{a.length&&(e(J(o)),i(!0))},[o,e,a]),s.jsx(oe,{recipeType:f,show:r,setShow:i})};export{ie as component};
